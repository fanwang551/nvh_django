# ä¼˜åŒ–åŽçš„æç¤ºè¯

## ðŸ“‹ é¡¹ç›®èƒŒæ™¯
éœ€è¦å¢žé‡é‡æž„ `D:\pythonProject\zlbbses\nvh_django\backend\apps\voc` æ¨¡å—
è™½ç„¶è¡¨ç»“æž„å˜åŒ–ï¼Œä½†æŽ¥å£åŠŸèƒ½ä¿æŒä¸€è‡´ã€‚

## ðŸŽ¯ å½“å‰ä»»åŠ¡
åœ¨ `apps` ä¸‹æ–°å»º `vehicle_body` æ¨¡å—ï¼Œ**å½“å‰ä»…éœ€å®žçŽ°** `VocOdorData.vue` ç•Œé¢æ‰€éœ€çš„æŽ¥å£ã€‚

**å…³é”®ä¿¡æ¯ï¼š**
- å‰ç«¯è·¯å¾„ï¼š`D:\pythonProject\zlbbses\nvh_django\frontend\src\views\vehicle-data\VocOdorData.vue`
- è¯¥ç•Œé¢**ä»…ä½¿ç”¨ SampleInfo è¡¨**
- å¯å‚è€ƒæ—§æ¨¡å— `apps/voc` çš„å®žçŽ°é€»è¾‘
- æ›¿æ¢æŽ¥å£å³å¯ï¼ŒåŽç»­ä¼šåˆ é™¤æ—§æŽ¥å£
---

## ðŸ“Š æ–°æ•°æ®åº“è®¾è®¡ï¼ˆ3å¼ è¡¨ï¼‰

### è¡¨1ï¼šSampleInfoï¼ˆæ ·å“ä¿¡æ¯è¡¨ï¼‰
**æ ¸å¿ƒå˜åŒ–ï¼š**
- âœ… é¡¹ç›®åç§°æ”¹ä¸ºç›´æŽ¥å­—æ®µï¼Œä¸å†å…³è”è½¦åž‹è¡¨
- âœ… VOC æ£€æµ‹æ•°æ®æ•´åˆåˆ°æ­¤è¡¨
- âœ… æ°”å‘³æ£€æµ‹æ•°æ®æ•´åˆåˆ°æ­¤è¡¨

```python
class SampleInfo(models.Model):
    """æ ·å“ä¿¡æ¯è¡¨ - æ•´åˆVOCå’Œæ°”å‘³æ•°æ®"""
    
    # åŸºæœ¬ä¿¡æ¯
    project_name = models.CharField(max_length=100, verbose_name='é¡¹ç›®åç§°')
    part_name = models.CharField(max_length=100, verbose_name='é›¶ä»¶åç§°')
    development_stage = models.CharField(max_length=50, null=True, blank=True, verbose_name='å¼€å‘é˜¶æ®µ')
    status = models.CharField(max_length=20, null=True, blank=True, verbose_name='çŠ¶æ€')
    test_order_no = models.CharField(max_length=50, verbose_name='æ£€æµ‹å§”æ‰˜å•å·', unique=True)
    sample_no = models.CharField(max_length=50, verbose_name='æ ·å“ç¼–å·', db_index=True)
    sample_image_url = models.CharField(max_length=255, null=True, blank=True, verbose_name='æ ·å“å›¾URL')
    test_date = models.DateField(null=True, blank=True,verbose_name='æ£€æµ‹æ—¶é—´')
    
    # VOCæ£€æµ‹æ•°æ®ï¼ˆ10é¡¹ï¼‰
    benzene = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='è‹¯')
    toluene = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='ç”²è‹¯')
    ethylbenzene = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='ä¹™è‹¯')
    xylene = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='äºŒç”²è‹¯')
    styrene = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='è‹¯ä¹™çƒ¯')
    formaldehyde = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='ç”²é†›')
    acetaldehyde = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='ä¹™é†›')
    acrolein = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='ä¸™çƒ¯é†›')
    acetone = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='ä¸™é…®')
    tvoc = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='TVOC')
    
    # æ°”å‘³æ£€æµ‹æ•°æ®ï¼ˆ4é¡¹ + å‡å€¼ï¼‰
    odor_static_front = models.DecimalField(max_digits=6, decimal_places=1, null=True, blank=True, verbose_name='é™æ€-å‰æŽ’')
    odor_static_rear = models.DecimalField(max_digits=6, decimal_places=1, null=True, blank=True, verbose_name='é™æ€-åŽæŽ’')
    odor_dynamic_front = models.DecimalField(max_digits=6, decimal_places=1, null=True, blank=True, verbose_name='åŠ¨æ€-å‰æŽ’')
    odor_dynamic_rear = models.DecimalField(max_digits=6, decimal_places=1, null=True, blank=True, verbose_name='åŠ¨æ€-åŽæŽ’')
    odor_mean = models.DecimalField(max_digits=6, decimal_places=1, null=True, blank=True, verbose_name='æ°”å‘³å‡å€¼')
    
    class Meta:
        db_table = 'voc_sample_info'
        verbose_name = 'æ ·å“ä¿¡æ¯'
        verbose_name_plural = 'æ ·å“ä¿¡æ¯'
        ordering = ['-id']
```

---

### è¡¨2ï¼šSubstanceï¼ˆç‰©è´¨åº“ï¼‰
**ä¿æŒä¸å˜**

```python
class Substance(models.Model):
    """ç‰©è´¨åº“è¡¨"""
    SUBSTANCE_TYPE_CHOICES = [
        ('standard', 'è¡Œæ ‡è§„å®š'),
        ('custom', 'è‡ªå®šä¹‰'),
    ]
    
    substance_name_cn = models.CharField(max_length=100, verbose_name='ç‰©è´¨ä¸­æ–‡å')
    substance_name_en = models.CharField(max_length=100, null=True, blank=True, verbose_name='ç‰©è´¨è‹±æ–‡å')
    cas_no = models.CharField(max_length=50, unique=True, verbose_name='CASå·')
    substance_type = models.CharField(max_length=20, choices=SUBSTANCE_TYPE_CHOICES, default='custom', verbose_name='ç‰©è´¨ç±»åž‹')
    odor_threshold = models.DecimalField(max_digits=12, decimal_places=3, null=True, blank=True, verbose_name='å—…é˜ˆå€¼(Î¼g/mÂ³)')
    organic_threshold = models.DecimalField(max_digits=12, decimal_places=3, null=True, blank=True, verbose_name='æœ‰æœºç‰©é˜ˆå€¼')
    limit_value = models.DecimalField(max_digits=12, decimal_places=3, null=True, blank=True, verbose_name='é™å€¼')
    odor_character = models.CharField(max_length=200, null=True, blank=True, verbose_name='æ°”å‘³ç‰¹æ€§')
    main_usage = models.TextField(null=True, blank=True, verbose_name='ä¸»è¦ç”¨é€”')
    remark = models.TextField(null=True, blank=True, verbose_name='å¤‡æ³¨')
    
    class Meta:
        db_table = 'substanceInfo'
        verbose_name = 'ç‰©è´¨åº“'
        verbose_name_plural = 'ç‰©è´¨åº“'
        ordering = ['id']
        indexes = [
            models.Index(fields=['cas_no']),
            models.Index(fields=['substance_name_cn']),
        ]
```

---

### è¡¨3ï¼šSubstancesTestDetailï¼ˆå…¨è°±æµ“åº¦æ˜Žç»†è¡¨ï¼‰
**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… è®°å½•æ¯ä¸ªæ ·å“çš„æ¯ç§ç‰©è´¨æµ“åº¦
- âœ… è‡ªåŠ¨è®¡ç®— Qij å’Œ Wih

```python
class SubstancesTestDetail(models.Model):
    """VOCåŠå…¨è°±ç‰©è´¨æµ“åº¦æ˜Žç»†è¡¨"""
    
    sample = models.ForeignKey(SampleInfo, on_delete=models.CASCADE, related_name='substance_details', verbose_name='æ‰€å±žæ ·å“')
    substance = models.ForeignKey(Substance, to_field='cas_no', db_column='cas_no', on_delete=models.CASCADE, verbose_name='ç‰©è´¨')
    
    # æ£€æµ‹æ•°æ®
    concentration = models.DecimalField(max_digits=12, decimal_places=3, verbose_name='æµ“åº¦(Î¼g/mÂ³)')
    retention_time = models.DecimalField(max_digits=8, decimal_places=4, null=True, blank=True, verbose_name='ä¿ç•™æ—¶é—´')
    match_degree = models.DecimalField(max_digits=5, decimal_places=2, null=True, blank=True, verbose_name='åŒ¹é…åº¦(%)')
    concentration_ratio = models.DecimalField(max_digits=8, decimal_places=3, null=True, blank=True, verbose_name='æµ“åº¦å æ¯”(%)')
    
    # è‡ªåŠ¨è®¡ç®—å­—æ®µ
    qij = models.DecimalField(max_digits=10, decimal_places=3, null=True, blank=True, verbose_name='æ°”å‘³é˜ˆç¨€é‡Šå€æ•° Qij')
    wih = models.DecimalField(max_digits=10, decimal_places=3, null=True, blank=True, verbose_name='æœ‰æœºç‰©é˜ˆç¨€é‡Šå€æ•° Wih')
    
    def save(self, *args, **kwargs):
        """ä¿å­˜æ—¶è‡ªåŠ¨è®¡ç®— Qij å’Œ Wih"""
        if self.substance.odor_threshold and self.substance.odor_threshold > 0:
            self.qij = self.concentration / self.substance.odor_threshold
        if self.substance.organic_threshold and self.substance.organic_threshold > 0:
            self.wih = self.concentration / self.substance.organic_threshold
        super().save(*args, **kwargs)
    
    class Meta:
        db_table = 'substance_test_details'
        verbose_name = 'VOCæµ“åº¦æ˜Žç»†'
        verbose_name_plural = 'VOCæµ“åº¦æ˜Žç»†'
        unique_together = [['sample', 'substance']]
```

---






