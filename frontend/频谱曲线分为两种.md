# 数据库表结构设计方案

## 方案建议：**保持现有表结构，增加测点类型字段**

### 一、修改 `ConditionMeasurePoint` 表

```
字段列表：
1. id (主键)
2. work_condition (工况名称)
3. measure_point (测点名称)
4. measure_type (测点类型) - 新增字段
   - 选项：'noise'(噪声)、'vibration'(振动)、'speed'(转速)

索引：
- (work_condition, measure_point)
- (measure_type)
```

### 二、保持 `AcousticTestData` 表不变

```
字段说明：
1. vehicle_model (外键)
2. condition_point (外键)
3. spectrum_json (频谱数据) - 所有类型都有
4. oa_json (总声压级/振动时域) - 噪声和振动使用
5. speech_clarity (语音清晰度) - 仅噪声使用
6. rms_value (有效值) - 噪声、振动、转速都使用
7. test_date (测试日期)

存储规则：
- 噪声测点：存储 spectrum_json、oa_json、speech_clarity、rms_value
- 振动测点：存储 spectrum_json、oa_json(作为振动时域)、rms_value
- 转速测点：存储 spectrum_json、rms_value
```
# 需求优化描述

## 背景
当前系统未区分测点类型，所有测点统一按噪声数据处理和展示，需要根据测点类型（噪声/振动/转速）进行差异化展示。

## 现状问题
用户选择"车型-工况-测点"后，系统默认输出：
- 噪声频谱图
- 总声压级曲线
- 详细信息表格包括车型、工况、测点、语音清晰度、有效值、测试日期六列
- 
**存在问题：** 未根据测点类型适配展示内容和单位

## 需求目标
根据测点类型智能展示对应的数据图表

## 详细需求

### 1. 噪声测点
**展示内容：**
- 噪声频谱图（纵坐标：dB）
- 总声压级曲线（纵坐标：dB）

**数据来源：**
- `spectrum_json`（频谱数据）
- `oa_json`（总声压级数据）

---

### 2. 振动测点
**展示内容：**
- 振动频谱图（纵坐标：**m/s²**）
- 振动时域曲线（纵坐标：**m/s²**）

**数据来源：**
- `spectrum_json`（频谱数据）
- `oa_json`（振动时域数据）

**关键变更：** 纵坐标单位从 dB 改为 m/s²

---

### 3. 转速测点
**展示内容：**
- **不显示图表**（仅记录数据）

**说明：** 转速数据仅用于数据分析，不需要前端可视化展示

---

## 实现要点

### 前端逻辑
```
IF 测点类型 == '噪声':
    显示噪声频谱图 + 总声压级曲线（单位：dB）+详细信息表格包括车型、工况、测点、语音清晰度(%)、有效值RMS、测试日期六列
    
ELSE IF 测点类型 == '振动':
    显示振动频谱图 + 振动时域曲线（单位：m/s²）+ 详细信息表格包括车型、工况、测点、有效值RSS、测试日期五列
    
ELSE IF 测点类型 == '转速':
    不显示图表，只显示详细信息表格包括车型、工况、测点、转速、测试日期五列
```

### 后端改动
1. 查询 `ConditionMeasurePoint` 表获取 `measure_type` 字段
2. 根据类型返回对应的数据结构和单位标识
3. 接口响应中增加 `measure_type` 字段供前端判断

### 数据库改动
按照方案在 `ConditionMeasurePoint` 表新增 `measure_type` 字段（枚举值：noise/vibration/speed）

