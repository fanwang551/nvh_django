非常清楚了！现在我来重写需求描述：

---

## 需求描述

### 一、数据类型定义

系统支持三种测试数据类型，通过测点类型区分：

| 数据类型 | 存储字段 | 字段说明 |
|---------|---------|---------|
| **噪声** | spectrum_json | 频谱数据，格式：`{"frequency": [...], "dB": [...]}` |
|  | oa_json | 总声压级数据，格式：`{"time": [...], "OA": [...]}` |
|  | speech_clarity | 语音清晰度（%）|
|  | rms_value | 有效值 dB(A) |
| **振动** | spectrum_json | 频谱数据，格式：`{"frequency": [...], "dB": [...]}` |
|  | acceleration_json | 加速度数据，格式：`{"time": [...], "Acceleration": [...]}` |
|  | rms_value | 有效值 m/s² |
| **转速** | spectrum_json | 频谱数据，格式：`{"frequency": [...], "dB": [...]}` |
|  | rpm | 转速值（rpm）|

### 二、功能需求

#### 2.1 单测点详细分析
用户选择：车型 + 单个工况 + 单个测点

**展示内容：**
- **图表1**：频谱曲线（spectrum_json）
- **图表2**：根据测点类型显示
  - 噪声：总声压级曲线（oa_json）
  - 振动：加速度曲线（acceleration_json）
  - 转速：不显示第二条曲线

#### 2.2 多测点对比分析
用户选择：车型 + 多个工况 + 多个测点

**展示逻辑：**
- 横轴：工况名称（如：压缩机双开1档、压缩机双开2档...）
- 纵轴：特征指标值
- 按数据类型自动分组生成多个图表

**示例场景：**
选择9个工况 + 6个测点：
- 压缩机本体Y（振动）
- 压缩机本体Z（振动）
- 车前0.5米（噪声）
- 车前1.65米（噪声）
- 压缩机转速（转速）
- 电子扇转速（转速）

**生成4个对比图表：**

| 图表 | 纵轴指标 | 包含测点 | 单位 |
|-----|---------|---------|------|
| 图表1 | 噪声RMS | 车前0.5米、车前1.65米 | dB(A) |
| 图表2 | 语音清晰度 | 车前0.5米、车前1.65米 | % |
| 图表3 | 振动RMS | 压缩机本体Y、压缩机本体Z | m/s² |
| 图表4 | 转速 | 压缩机转速、电子扇转速 | rpm |

**分组规则：**
- 同一数据类型的同一指标在同一图表中展示
- 不同数据类型或不同指标分别展示在不同图表中
- 每个图表中可包含多条曲线（不同测点）

### 三、表结构设计建议

#### 方案一：保持现有表结构（推荐）

**优点：** 结构简单，易于维护

**修改点：**

1. **ConditionMeasurePoint 表增加字段：**
```python
class ConditionMeasurePoint(models.Model):
    work_condition = models.CharField(max_length=100, verbose_name='工况', db_index=True)
    measure_point = models.CharField(max_length=100, verbose_name='测点', db_index=True)
    
    # 新增字段
    data_type = models.CharField(
        max_length=20, 
        choices=[
            ('noise', '噪声'),
            ('vibration', '振动'),
            ('rpm', '转速')
        ],
        verbose_name='数据类型',
        db_index=True
    )
    unit = models.CharField(max_length=20, verbose_name='单位')  # dB(A), m/s², rpm
```

2. **AcousticTestData 表修改：**
```python
class AcousticTestData(models.Model):
    vehicle_model = models.ForeignKey(...)
    condition_point = models.ForeignKey(...)
    
    # 通用字段
    spectrum_json = models.JSONField(null=True, blank=True, verbose_name='频谱数据')
    
    # 噪声专用
    oa_json = models.JSONField(null=True, blank=True, verbose_name='总声压级数据')
    speech_clarity = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='语音清晰度%')
    
    # 振动专用
    acceleration_json = models.JSONField(null=True, blank=True, verbose_name='加速度数据')
    
    # 通用有效值（噪声和振动共用）
    rms_value = models.DecimalField(max_digits=10, decimal_places=4, null=True, blank=True, verbose_name='有效值')
    
    # 转速专用
    rpm = models.DecimalField(max_digits=10, decimal_places=2, null=True, blank=True, verbose_name='转速rpm')
    
    test_date = models.DateField(null=True, blank=True, verbose_name='测试日期')
```

**字段使用规则：**
- 噪声数据：填充 spectrum_json, oa_json, speech_clarity, rms_value
- 振动数据：填充 spectrum_json, acceleration_json, rms_value
- 转速数据：填充 spectrum_json, rpm

#### 方案二：拆分为多个表（不推荐）

创建 NoiseTestData、VibrationTestData、RpmTestData 三个表，但会增加查询复杂度。

---

### 四、前端展示逻辑伪代码

```python
# 多测点对比
selected_data = AcousticTestData.objects.filter(
    vehicle_model=vehicle,
    condition_point__work_condition__in=selected_conditions,
    condition_point__measure_point__in=selected_points
)

# 按数据类型和指标分组
charts = {
    'noise_rms': [],      # 噪声RMS
    'noise_clarity': [],  # 语音清晰度
    'vibration_rms': [],  # 振动RMS
    'rpm': []             # 转速
}

for data in selected_data:
    data_type = data.condition_point.data_type
    
    if data_type == 'noise':
        if data.rms_value:
            charts['noise_rms'].append(data)
        if data.speech_clarity:
            charts['noise_clarity'].append(data)
    elif data_type == 'vibration':
        if data.rms_value:
            charts['vibration_rms'].append(data)
    elif data_type == 'rpm':
        if data.rpm:
            charts['rpm'].append(data)

# 生成图表
for chart_type, chart_data in charts.items():
    if chart_data:
        generate_chart(chart_type, chart_data)
```

---

