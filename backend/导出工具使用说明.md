# MySQL数据导出到Excel工具使用说明

## 工具介绍

本工具包含两个Python脚本，用于将MySQL数据库中的表数据导出到Excel文件：

1. `export_mysql_to_excel.py` - 完整功能版本
2. `simple_export_excel.py` - 简化版本（推荐使用）

## 功能特点

✅ **格式标准化**
- 第一行：数据库字段英文名
- 第二行：字段中文说明
- 第三行开始：实际数据

✅ **NOT NULL字段标记**
- 自动检测数据库字段约束
- NOT NULL字段在中文说明中添加"(*必填)"标记
- NOT NULL字段使用红色背景和字体突出显示

✅ **自动排除Django系统表**
- 自动过滤 `auth_user`、`django_session` 等系统表
- 只导出用户业务数据表

✅ **美化格式**
- 自动调整列宽
- 标题行高亮显示
- 中文说明行背景色区分
- NOT NULL字段特殊颜色标记

✅ **数据类型处理**
- 自动处理日期时间格式
- 处理NULL值显示为空

## 环境要求

### 必须依赖
- Python 3.6+
- Django项目已配置
- pymysql
- openpyxl

### 安装缺失依赖

```bash
pip install openpyxl
```

## 使用方法

### 方法一：简化版本（推荐）

```bash
cd d:\\pythonProject\\zlbbses\\nvh_django\\backend
python simple_export_excel.py
```

运行后选择操作：
1. 导出悬架隔振率测试表（示例）
2. 查看所有表列表
3. 导出指定表

### 方法二：完整版本

```bash
cd d:\\pythonProject\\zlbbses\\nvh_django\\backend
python export_mysql_to_excel.py
```

运行后选择操作：
1. 导出所有用户表
2. 导出指定表
3. 查看所有表列表

## 字段映射配置

### 悬架隔振率测试表映射示例

```python
field_mappings = {
    "id": "序号",
    "test_date": "测试日期", 
    "test_location": "测试地点",
    "test_engineer": "测试工程师",
    "suspension_type": "悬架类型",
    "tire_pressure": "轮胎气压",
    "test_condition": "测试工况",
    "vehicle_model_id": "车型编号"
}
```

### 自定义字段映射

如需修改字段映射关系，编辑脚本中的 `field_mappings` 字典即可。

## 项目中的数据表

### 当前可导出的用户表：

1. **车型和零部件**
   - `vehicle_models` - 车型信息
   - `components` - 零部件信息

2. **模态分析模块**
   - `test_projects` - 测试项目
   - `modal_data` - 模态数据
   - `airtightness_tests` - 气密性测试
   - `airtightness_images` - 气密性图片

3. **动刚度模块**
   - `dynamic_stiffness_tests` - 动刚度测试
   - `dynamic_stiffness_data` - 动刚度数据
   - `vehicle_mount_isolation_tests` - 整车悬置隔振率测试
   - `mount_isolation_data` - 悬置隔振率数据
   - `vehicle_suspension_isolation_tests` - 整车悬架隔振率测试
   - `suspension_isolation_data` - 悬架隔振率数据

4. **声学性能模块**
   - `sound_insulation_areas` - 隔声区域
   - `sound_insulation_data` - 隔声量数据
   - `vehicle_sound_insulation_data` - 车型隔声量数据
   - `vehicle_reverberation_data` - 车辆混响时间数据
   - `sound_absorption_coefficients` - 吸声系数
   - `sound_insulation_coefficients` - 隔声量系数
   - `material_porosity_flow_resistance` - 材料孔隙率流阻

## 输出文件

### 单表导出
- 文件名：`表名.xlsx`
- 位置：脚本运行目录

### 批量导出  
- 目录名：`excel_exports_YYYYMMDD_HHMMSS`
- 每个表一个Excel文件

## 示例输出格式

### 基本格式示例

| id | test_date | test_location | test_engineer |
|----|-----------|---------------|---------------|
| 序号 (*必填) | 测试日期 (*必填) | 测试地点 | 测试工程师 (*必填) |
| 1 | 2024-01-15 | 上海 | 张工 |
| 2 | 2024-01-16 | 北京 | 李工 |

### 颜色标记说明

- **第一行（英文字段名）**: 蓝色背景 + 白色字体
- **第二行（中文说明）**: 
  - 普通字段: 浅蓝色背景
  - NOT NULL字段: 浅红色背景 + 红色字体 + "(*必填)"标记
- **数据行**: 默认白色背景

## 故障排除

### 常见问题

1. **ImportError: No module named 'openpyxl'**
   ```bash
   pip install openpyxl
   ```

2. **数据库连接失败**
   - 检查Django settings.py中的数据库配置
   - 确认MySQL服务已启动
   - 验证数据库连接信息

3. **表不存在**
   - 先运行查看表列表功能
   - 确认表名拼写正确

4. **权限问题**
   - 确保数据库用户有读取权限
   - 确保文件写入目录有权限

### 获得帮助

如遇到问题，请检查：
1. Python版本是否兼容
2. 依赖包是否完整安装
3. Django项目配置是否正确
4. 数据库连接是否正常

## 扩展功能

如需添加更多功能，可以修改脚本：
1. 添加更多字段映射
2. 自定义Excel样式
3. 添加数据过滤条件
4. 支持多工作表导出